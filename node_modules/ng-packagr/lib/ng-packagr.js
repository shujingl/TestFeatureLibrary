"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// BUILD STEP IMPLEMENTATIONS
var package_1 = require("./steps/package");
var copy_1 = require("./util/copy");
var rimraf_1 = require("./util/rimraf");
var bundler_1 = require("./bundler");
// Logging
var log = require("./util/log");
exports.ngPackage = function (opts) {
    log.info("Building Angular library");
    /** Project configuration */
    var ngPkg;
    // 0. READ `ng-package.json` and obtain model
    return package_1.readPackage(opts.project)
        .then(function (p) {
        log.debug('package loaded');
        log.debug(JSON.stringify(p));
        ngPkg = p;
        // 1. CLEAN
        return Promise.all([
            rimraf_1.rimraf(p.dest),
            rimraf_1.rimraf(p.workingDirectory)
        ]);
    })
        .then(function () { return bundler_1.generateNgBundle(ngPkg, ngPkg); })
        .then(function () { return copy_1.copyFiles(ngPkg.src + "/README.md", ngPkg.dest); })
        .then(function () { return copy_1.copyFiles(ngPkg.src + "/LICENSE", ngPkg.dest); })
        .then(function () { return package_1.writePackage(ngPkg.src, ngPkg.dest, ngPkg.artefacts); })
        .then(function () {
        log.success("Built Angular library from " + ngPkg.src + ", written to " + ngPkg.dest);
    })
        .catch(function (err) {
        // Report error messages and throw the error further up
        log.error(err);
        return Promise.reject(err);
    });
};
//# sourceMappingURL=ng-packagr.js.map